<?xml version='1.0' encoding='windows-1252'?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
  <Product Name='HTTP Endpoints Activity Agent' Id='EACE78E5-40FA-47AB-8619-43A35A32BA7A' UpgradeCode='BB441838-287F-46FA-9D23-80A9618F6E4D'
      Language='1033' Codepage='1252' Version='1.0.0' Manufacturer='AIMS Innovation'>
    <Package Id='*' Keywords='Installer'
        Description="HTTP Endpoints Activity Agent Installer"
        Manufacturer='AIMS Innovation'
        InstallerVersion='200' Languages='1033' Compressed='yes' SummaryCodepage='1252' />

    <Media Id='1' Cabinet='Main.cab' EmbedCab='yes' DiskPrompt="CD-ROM #1" />
    <Property Id='DiskPrompt' Value="HTTP Endpoints Activity Agent 1.0 Installation [1]" />

    <Property Id="WIXUI_INSTALLDIR" Value="INSTALLDIR" />

    <Property Id="AIMS_SERVICE_ACCOUNT_VALID" Secure="yes" />
    <Property Id="AIMS_SERVICE_USER" Secure="yes" />
    <Property Id="AIMS_SERVICE_PASSWORD" Secure="yes" />

    <EnsureTable Id="ListBox" />

    <Binary Id="Aims.Sdk.Installer.Actions.dll"
        SourceFile="$(var.Aims.Sdk.Installer.Actions.TargetDir)\$(var.Aims.Sdk.Installer.Actions.TargetName).CA.dll" />

    <CustomAction Id="ValidateServiceAccount" BinaryKey="Aims.Sdk.Installer.Actions.dll"
        DllEntry="ValidateServiceAccount" Execute="immediate" Return="check" />

    <Directory Id='TARGETDIR' Name='SourceDir'>
      <Directory Id='ProgramFilesFolder' Name='PFiles'>
        <Directory Id='AIMSInnovation' Name='AIMS Innovation'>
          <Directory Id='INSTALLDIR' Name='HTTP Endpoint Activity Agent'>
            <Component Id='MainExecutable' Guid='9D3716A3-C0D9-4186-B0C5-BA7021C4B35C'>
              <File Id='EndpointAgentExe' Name='aims-http-endpt-agent.exe' DiskId='1'
                  Source='$(var.Aims.EndpointAgent.TargetPath)' KeyPath='yes' />
              <File Id='EndpointAgentExeConfig' Name='aims-http-endpt-agent.exe.config' DiskId='1'
                  Source='$(var.Aims.EndpointAgent.TargetPath).config' />
              <File Id='AimsSdkDll' Name='Aims.Sdk.dll' DiskId='1'
                  Source='$(var.Aims.EndpointAgent.TargetDir)\Aims.Sdk.dll' />
              <File Id='NewtonsoftJsonDll' Name='Newtonsoft.Json.dll' DiskId='1'
                  Source='$(var.Aims.EndpointAgent.TargetDir)\Newtonsoft.Json.dll' />

              <File Id='config.schema.json' Name='config.schema.json' DiskId='1'
                    Source='$(var.SolutionDir)\Scripts\config.schema.json' />
              <File Id='configure.ps1' Name='configure.ps1' DiskId='1'
                    Source='$(var.SolutionDir)\Scripts\configure.ps1' />
              <File Id='sample.config.json' Name='sample.config.json' DiskId='1'
                    Source='$(var.SolutionDir)\Scripts\sample.config.json' />
              <File Id='agent.config' Name='agent.config' DiskId='1'
                    Source='$(var.SolutionDir)\Scripts\agent.config' />

              <RegistryValue Id='SetupTarget' Root="HKLM" Key="Software\[Manufacturer]\[ProductName]" Type="string" Value="[INSTALLDIR]"/>
              <ServiceInstall Id="EndpointAgentServiceInstaller" Type="ownProcess"
                  Name="aims-http-endpt-agent" DisplayName="AIMS HTTP Endpoints Agent"
                  Start="auto" Account="[AIMS_SERVICE_USER]" Password="[AIMS_SERVICE_PASSWORD]"
                  ErrorControl="normal" Vital="yes" />
              <ServiceControl Id="EndpointAgentServiceStart" Name="aims-http-endpt-agent"
                  Start="install" Stop="uninstall" Remove="uninstall" Wait="yes" />
            </Component>
          </Directory>
        </Directory>
      </Directory>
    </Directory>

    <Feature Id='Complete' Title='HTTP Endpoints Activity Agent' Description='The complete package.'
        Display='expand' Level='1' ConfigurableDirectory='INSTALLDIR'>
      <Feature Id='MainProgram' Title='Program' Description='The main executable.' Level='1'>
        <ComponentRef Id='MainExecutable' />
      </Feature>
    </Feature>

    <UIRef Id="InstallUI" />
  </Product>
</Wix>